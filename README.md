# 冰冷的她醒来之前 —— 基于 boardgame.io 开发的卡牌游戏

[![Ask DeepWiki](https://deepwiki.com/badge.svg)](https://deepwiki.com/Yishanka/EmbalmingGirl)

## 1. 项目简介

### 1.1 游戏背景

末世降临，病毒肆虐，废墟中的校舍成了最后的避难所。

然而，在一次黑夜的尖叫之后，宁静被打破——一名少女死去，而凶手……就在我们之间。

怀疑与恐惧交织，秘密与谎言弥漫。信任与真相是否还会到来……

### 1.2 游戏机制概述

在这场游戏里，你是幸存者中的一员。

你手中握有多张卡牌，它们既是你的伪装，也是你的命运。

* 你可以随时发声，推理、欺骗，或是隐藏真相。
* 你可以用行动来“救助”“怀疑”或“揭示”。
* 你**最后的一张牌**，将决定你真正的身份与归属。

每个身份都藏着各自的胜利条件，且存在优先级。

**救下同伴，如果你不是犯人……如果你不是感染者……外星人……**

请谨记，**你永远无法确信身边的人是谁**。

### 1.3 技术栈

* **游戏框架**：boardgame.io
* **语言**：TypeScript

---

## 2. 功能特性

### 2.1 核心玩法

* **初始状态**：每名玩家持有多张不同身份的卡牌。

* **回合行动**：轮流出牌，每张牌都拥有“点数”与“能力”。

* **使用形式**：

  1. **“调和”**（背面放置）：尝试救助死去的同伴，点数累加作为“调和点数”。
  2. **“质疑”**（背面放置）：指认谁是犯人，点数累加作为“质疑点数”。
  3. **“打出”**（正面放置）：发动卡牌的特殊能力，如交换、查看、夺取等。

* 结束判定：当所有玩家只剩最后一张牌时，游戏立即结束，最后一张牌就是你的真实身份。

* 点数结算：

  * “调和点数” ≥ 要求值 → “调和成功”，同伴复活。
  * “质疑点数”最高 → “被监禁”。

玩家可以随时自由交谈、交换情报，甚至故意误导。

### 2.2 卡牌介绍（胜利优先级从高到低）

| 名称       | 点数 | 能力简述               | 特殊机制             | 胜利条件 |
| -------- | -- | ------------------ | ---------------- | ---- |
| **外星人**  | -1 | 无                  | 可伪装为犯人        | 被监禁  |
| **感染者**  | 0  | 下回合优先抽取 1 张调和牌     | —                | 调和失败 |
| **犯人**   | 0  | 无                  | 不能使用     | 不被监禁 |
| **共犯**   | 0  | 将 1 张质疑牌移动到其他玩家    | —                | 犯人胜利 |
| **学生会长** | 3  | 无                  | 持有者第一个出牌         | 调和成功 |
| **班长**   | 2  | 与 1 名玩家交换各 1 张手牌   | —                | 调和成功 |
| **优等生**  | 2  | 查看“犯人”当前归属         | —  | 调和成功 |
| **保健委员** | 1  | 从打出牌区中回收 1 张牌（除保健委员） | —                | 调和成功 |
| **风纪委员** | 1  | 查看 1 名玩家的全部手牌      | —                | 调和成功 |
| **图书委员** | 1  | 查看所有调和牌            | —                | 调和成功 |
| **大小姐**  | 1  | 抢夺 1 张他人手牌并交换      | —                | 调和成功 |
| **新闻部**  | 1  | 全体同时将 1 张牌传给下家     | —                | 调和成功 |
| **归宅部**  | 0  | 与调和牌区交换 1 张牌       | —                | 无人胜利 |

### 2.3 特殊规则

* 玩家不能监禁自己。
* 负质疑点数按 **0** 计算。
* 若质疑点数相同，则无人被监禁。
* 当玩家回合结束且仅剩最后一张牌时，该牌将被锁定，不可再被操作。
* “优等生”使用能力时，持有“犯人”的玩家必须声明身份，但“外星人”可选择声明或不声明。

#### 进阶模式

* 可以监禁自己。
* 质疑点数允许为负数。
* 最后一张牌不再锁定。
* 使用“保健委员”能力时，必须额外弃 1 张牌才能换牌。

---

## 3. 项目结构

```csharp
apps/                       # 前后端应用
│
├── client/                 # 前端（React + boardgame.io 客户端）
│   ├── public/             # 静态资源
│   ├── src/                # 前端源码
│   │   ├── board/          # 游戏界面（Board 组件）
│   │   │   └── EmbalmingGirlBoard.tsx
│   │   ├── css/            # 样式文件
│   │   ├── pages/          # 页面组件
│   │   ├── App.tsx         # 前端入口组件
│   │   ├── index.tsx       # React 入口文件
│   │   └── ...             # 其他 React 工具与配置
│   ├── package.json        # 前端依赖与配置
│   └── tsconfig.json       # TypeScript 配置
│
├── server/                 # 后端（boardgame.io 服务器）
│   ├── src/
│   │   └── intex.ts        # 服务器入口文件（疑似拼写错？应为 index.ts）
│   ├── package.json
│   └── tsconfig.json
│
shared/                     # 前后端共享逻辑与类型定义
│   ├── src/
│   │   └── embalmingGirl/  # 游戏核心逻辑
│   │       ├── cards.ts       # 卡牌定义
│   │       ├── embalmingGirl.ts # 游戏主配置（boardgame.io G 对象）
│   │       ├── moves.ts       # 玩家可执行的操作
│   │       ├── palyerView.ts  # 玩家可见信息（可能拼写错：playerView.ts）
│   │       ├── setup.ts       # 游戏初始化逻辑
│   │       ├── turn.ts        # 回合与阶段规则
│   │       └── types.ts       # 类型定义
│   ├── index.ts            # 共享模块入口
│   └── dist/               # 构建后的输出
│
package.json                # Monorepo 根配置
```

---

## 4. 开发进展

### 4.1 已实现功能

* **卡牌逻辑**：大部分卡牌的出牌能力以及调和与质疑已完成实现。
* **房间机制**：基础的房间创建与加入功能。
* **界面渲染**：基本的主界面与游戏界面交互。
* **多人支持**：boardgame.io 支持多人模式，但同步与交互尚未充分测试。

### 4.2 待优化 / 已知问题

* 多人游戏尚未进行完整压力测试，可能存在 Bug。
* UI/UX 较为简陋，缺少操作指引与视觉提示。
* 游戏结束判定与身份优先级逻辑需要进一步验证。

### 4.3 未来规划

* **多人在线对战**：支持玩家通过网站直接进入房间并游玩。
* **完整流程优化**：实现一个无明显 Bug 的完整游戏循环。
* **用户体验改进**：增加提示动画、身份揭示、结算界面等。

---

## 5. 协助开发

### 5.1 开发环境搭建

以下步骤适用于 fork 本项目后在本地初始化。

**克隆仓库**

```bash
git clone https://github.com/<your-username>/EmbalmingGirl.git
cd EmbalmingGirl
```

**安装依赖**

在项目根目录一次性安装所有依赖：

```bash
npm install
```

这会同时安装 `apps/client/`、`apps/server/` 和 `shared/` 中的依赖。

**构建共享逻辑**

游戏核心逻辑位于 `shared/` 模块，需要先构建：

```bash
cd shared
npm run build
```

编译后的文件会输出到 `shared/dist/`。

**启动服务器**

```bash
cd ../apps/server
npm run dev
```

默认运行在：

```
http://localhost:8000
```

**启动客户端**

在另一个终端运行：

```bash
cd ../client
npm start
```

默认运行在：

```
http://localhost:3000
```

访问 `http://localhost:3000` 即可进入游戏界面。

### 5.2 开发建议

* 修改 **`shared/`** 中的游戏逻辑文件后，需要重新运行 `npm run build`。
* 推荐同时开两个终端窗口：一个跑 `server`，一个跑 `client`。
* 提交代码前请运行 `npm run lint` 确保代码风格统一。

---